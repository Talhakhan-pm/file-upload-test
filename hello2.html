<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Details and Upload File</title>
</head>
<body>

    <h2>Agent Data Submission</h2>
    <form id="dataForm">
        <!-- Personal Information -->
        <label for="firstName">First Name:</label>
        <input type="text" id="firstName" name="firstName" required><br><br>

        <label for="lastName">Last Name:</label>
        <input type="text" id="lastName" name="lastName" required><br><br>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br><br>

        <!-- Add more inputs as necessary -->

        <!-- File Upload -->
        <label for="file">Upload Driver's License Picture:</label>
        <input type="file" id="file" name="file" required><br><br>

        <input type="submit" value="Submit">
    </form>

    <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
    <script>
        document.getElementById("dataForm").addEventListener("submit", function(event) {
            event.preventDefault();  // Prevent default form submission

            // Extract form data
            const firstName = document.getElementById("firstName").value;
            const lastName = document.getElementById("lastName").value;
            const email = document.getElementById("email").value;

            // Extract file to be uploaded
            const fileInput = document.getElementById("file");
            const file = fileInput.files[0];

            if (file) {
                // Prepare the FormData object for Cloudinary upload
                const formData = new FormData();
                formData.append("file", file);
                formData.append("upload_preset", "my_upload_preset");  // Replace with your Cloudinary preset

                // Upload file to Cloudinary
                fetch(`https://api.cloudinary.com/v1_1/YOUR_CLOUD_NAME/upload`, {
                    method: "POST",
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    // Once file is uploaded, get the Cloudinary URL
                    const cloudinaryUrl = data.secure_url;

                    // Now send the form data and Cloudinary URL to Google Apps Script
                    fetch("YOUR_GOOGLE_SCRIPT_WEB_APP_URL", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            firstName: firstName,
                            lastName: lastName,
                            email: email,
                            fileUrl: cloudinaryUrl  // Add Cloudinary file URL
                        })
                    })
                    .then(response => response.text())
                    .then(result => {
                        alert("Data submitted successfully: " + result);
                    })
                    .catch(error => {
                        console.error("Error submitting to Google Sheets:", error);
                    });
                })
                .catch(error => {
                    console.error("Error uploading file to Cloudinary:", error);
                });
            }
        });
    </script>

</body>
</html>
